# Мини-CRM: Система Распределения Лидов

Этот проект представляет собой минималистичную CRM-систему на FastAPI с использованием асинхронной SQLAlchemy 2.0 (AIOsqlite) для реализации логики взвешенного распределения входящих лидов (обращений) по операторам с учетом их текущей нагрузки и лимитов.

## Требования

* Python 3.9+
* `pip` (менеджер пакетов Python)

## Установка и запуск проекта

Для запуска проекта необходимо создать и активировать виртуальное окружение, а затем установить все необходимые зависимости.

### 
1. Установка зависимостей
Установите все необходимые библиотеки, включая FastAPI, Uvicorn (HTTP-сервер), SQLAlchemy и AIOsqlite (для асинхронной работы с базой данных).

Terminal
```
pip install fastapi "uvicorn[standard]" "sqlalchemy[asyncio]" aiosqlite pydantic
```
### 
2. Запуск сервера Uvicorn

Запустите приложение, используя Uvicorn. Убедитесь, что вы находитесь в корневой папке проекта.

Terminal
```
uvicorn main:app --reload
```
Сервер будет доступен по адресу: http://127.0.0.1:8000

 Документация и тестирование
После запуска сервера вы можете получить доступ к интерактивной документации Swagger UI, которая автоматически генерируется FastAPI.

Интерактивная документация (Swagger UI): http://127.0.0.1:8000/docs

## Порядок тестирования API
Для проверки логики распределения лидов используйте следующий порядок действий в Swagger UI:

POST /operators/: Создайте несколько операторов (например, 2-3). Установите max_active_leads (лимит активных лидов).

POST /sources/: Создайте новый источник (например, telegram_bot).

POST /sources/{source_id}/config: Настройте веса распределения для созданного источника, указав operator_id и weight (вес).

POST /contacts/register: Регистрируйте новые обращения. Система автоматически распределит их между доступными операторами, учитывая заданные веса и их лимиты.

GET /distribution_status/: Проверьте текущую нагрузку и лимиты каждого оператора.

## Очистка данных
База данных проекта хранится в файле crm.db в корневой папке. Если вам нужно начать работу с нуля (например, после изменения моделей):

Остановите сервер Uvicorn (Ctrl+C).

Удалите файл crm.db.

Перезапустите Uvicorn. Таблицы будут созданы автоматически.
